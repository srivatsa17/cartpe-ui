name: CI/CD
env:
    VERCEL_ORG_ID: ${{ secrets.VERCEL_ORG_ID }}
    VERCEL_PROJECT_ID: ${{ secrets.VERCEL_PROJECT_ID }}
on:
    push:
        branches:
        - master
        - development
jobs:
    install-dependencies:
        runs-on: ubuntu-latest
        strategy:
            matrix:
                node-version: [18.x]
        steps:
        -   name: Checkout Repository
            uses: actions/checkout@v3

        -   name: Setup Node.js ${{ matrix.node-version }}
            uses: actions/setup-node@v3
            with:
                node-version: ${{ matrix.node-version }}

        -   name: Install dependencies
            run: npm ci

    run-linter:
        runs-on: ubuntu-latest
        needs: install-dependencies
        steps:
        -   name: Checkout Repository
            uses: actions/checkout@v3

        -   name: Run ESLint
            run: npm run lint

    deploy-pre-production:
        if: github.event_name == 'push' && github.ref == 'refs/heads/development'
        runs-on: ubuntu-latest
        needs: run-linter
        steps:
        -   name: Checkout Repository
            uses: actions/checkout@v3

        -   name: Install Vercel CLI
            run: npm install --global vercel@latest

        -   name: Pull Vercel Environment Information
            run: vercel pull --yes --environment=preview --token=${{ secrets.VERCEL_TOKEN }}

        -   name: Build Project Artifacts
            run: vercel build --token=${{ secrets.VERCEL_TOKEN }}

        -   name: Deploy Project Artifacts to Vercel
            run: vercel deploy --prebuilt --token=${{ secrets.VERCEL_TOKEN }}

    deploy-production:
        if: github.event_name == 'push' && github.ref == 'refs/heads/master'
        runs-on: ubuntu-latest
        needs: run-linter
        steps:
        -   name: Checkout Repository
            uses: actions/checkout@v3

        -   name: Install Vercel CLI
            run: npm install --global vercel@latest

        -   name: Pull Vercel Environment Information
            run: vercel pull --yes --environment=production --token=${{ secrets.VERCEL_TOKEN }}

        -   name: Build Project Artifacts
            run: vercel build --prod --token=${{ secrets.VERCEL_TOKEN }}

        -   name: Deploy Project Artifacts to Vercel
            run: vercel deploy --prebuilt --prod --token=${{ secrets.VERCEL_TOKEN }}
